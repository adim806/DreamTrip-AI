# מערכת RAG ממוקדת עם Gemini

## סקירה כללית

שיפרנו את מערכת הRAG (Retrieval-Augmented Generation) במערכת באמצעות הפרדה למודל ייעודי של Gemini. מודל זה מתמחה בעיבוד מידע חיצוני והפיכתו לתשובות טבעיות ומובנות.

## יתרונות הגישה החדשה

1. **ביצועים משופרים**: המודל הנפרד יכול להיות ממוקד יותר ולפעול במקביל למודל הראשי
2. **חיסכון במשאבים**: המודל הראשי יכול להתמקד בניהול השיחה בלבד
3. **מטמון תשובות**: המערכת כוללת מנגנון מטמון המאפשר לחסוך בקריאות חוזרות
4. **הנחיות ממוקדות**: כל סוג מידע מקבל הנחיות מותאמות אישית לעיבוד המיטבי

## ארכיטקטורה

המערכת מורכבת מ:

1. **GeminiRAGProcessor**: מודול ייעודי לעיבוד נתונים חיצוניים באמצעות Gemini API
2. **תבניות מותאמות**: פרומפטים שונים עבור כל סוג נתונים (מלונות, מזג אוויר, מסעדות)
3. **מנגנון מטמון**: זיכרון של תשובות קודמות לחיסכון בקריאות חוזרות

## דרישות

- מפתח API של Gemini (Google AI)
- הגדרת המפתח בקובץ `.env` תחת המשתנה `VITE_GEMINI_API_KEY`

## שילוב עם המערכת הקיימת

מערכת הRAG החדשה משתלבת בזרימה הקיימת:

1. משתמש שולח שאילתה (למשל חיפוש מלונות)
2. המערכת מזהה שאילתה עם intent חיצוני (Find-Hotel)
3. המערכת שולפת נתונים חיצוניים (מלונות)
4. במקום לשלוח את הנתונים למודל הראשי, המערכת שולחת אותם למודל Gemini הממוקד
5. מודל Gemini מעבד את הנתונים ומייצר תשובה טבעית ומובנת
6. התשובה המעובדת מוצגת למשתמש

## תחזוקה והרחבה

להוספת סוגי מידע חדשים:

1. הוסיפו פונקציית `build[Type]Prompt` חדשה ב-`GeminiRAGProcessor.js`
2. עדכנו את ה-`switch` בפונקציה `buildPrompt`
3. במידת הצורך, עדכנו את ה-`getSystemInstructionsForIntent` עם הנחיות ספציפיות

## דוגמאות לפרומפטים

### חיפוש מלונות

```javascript
let prompt = `User query: "${userQuery}"\n\n`;
prompt += `I need to provide hotel information for ${displayLocation}`;

if (budget_level) {
  prompt += ` with ${budget_level} budget level`;
}

prompt += ".\n\n";
prompt += `Available hotels:\n`;
// ... פרטי המלונות ...
```

### חיפוש מזג אוויר

```javascript
let prompt = `User query: "${userQuery}"\n\n`;
prompt += `I need to provide weather information for ${displayLocation} on ${
  date || "today"
}.\n\n`;
prompt += `Weather data:\n`;
// ... נתוני מזג אוויר ...
```

## הערות מימוש

- המערכת יודעת להתמודד עם תרחישים בהם מפתח ה-API לא זמין או שאירעה שגיאה
- המערכת מנהלת את מחזור החיים של המודל (אתחול, שימוש, שגיאות)
- יש מנגנון יעיל למניעת כפילות בקריאות API
